000100161107CREATE or replace PROCEDURE bbiweb.st_Dept  (IN store int)
000200160511result sets 1
000300160511LANGUAGE SQL
000400160511BEGIN
000500170602/* Store number has been passed */
000600160511DECLARE c1 CURSOR with return FOR
000700170421SELECT DISTINCT  DECIMAL(R09ADT * 10,5,0) AS R09ADT,
000800170421TRIM(R07DSC) AS R07DSC
000900170421FROM GLCUST.BRP090
001000170421join glcust.brp070 on
001100170421R07CO = R09CO
001200170421AND  R07dpt = R09adt
001300170421join glcust.bstore on
001400170421s99co = r09co
001500170421and s99loc = r09str
001600170421join gldbfa.glpct on
001700170421ctrc01 = digits(s99co)
001800170421and ctrc02 = digits(s99bv)
001900170421and ctrc03 = s99dis
002000170720and ctrc04 = right(digits(S99bus),4)
002100170421and ctrc05 = digits(r09adt)
002200170421and ctrc06 = '470700'
002300170421and ctrc07 = ''
002400170421and CTACTV = '1'
002500170421where R09STR = STORE
002600170726AND   (R09DPT beTWEEN 2 AND 17
002700170726 or   R09DPT = 97)
002800170421
002900170421UNION
003000170421
003100170421SELECT DISTINCT  DECIMAL(R09ADT * 10 + 1,5,0) AS R09ADT,
003200170421TRIM(R07DSC) || ' SUPPLIES' AS R07DSC
003300170421FROM GLCUST.BRP090
003400170421join glcust.brp070 on
003500170421R07CO = R09CO
003600170421AND  R07dpt = R09adt
003700170421join glcust.bstore on
003800170421s99co = r09co
003900170421and s99loc = r09str
004000170421join gldbfa.glpct on
004100170421ctrc01 = digits(s99co)
004200170421and ctrc02 = digits(s99bv)
004300170421and ctrc03 = s99dis
004400170720and ctrc04 = right(digits(s99bus),4)
004500170421and ctrc05 = digits(r09adt)
004600170421and ctrc06 = '510700'
004700170421and ctrc07 = ''
004800170421and CTACTV = '1'
004900170421where R09STR = STORE
005000170726AND   (R09DPT BETWEEN 2 AND 17
005100170726 or   R09DPT = 97)
005200170421order by 2  ;
005300170602/* Store number has NOT been passed */
005400170602DECLARE c2 CURSOR with return FOR
005500170602SELECT DISTINCT  DECIMAL(R09ADT * 10,5,0) AS R09ADT,
005600170602TRIM(R07DSC) AS R07DSC
005700170602FROM GLCUST.BRP090
005800170602join glcust.brp070 on
005900170602R07CO = R09CO
006000170602AND  R07dpt = R09adt
006100170602join glcust.bstore on
006200170602s99co = r09co
006300170602and s99loc = r09str
006400170602join gldbfa.glpct on
006500170602ctrc01 = digits(s99co)
006600170602and ctrc02 = digits(s99bv)
006700170602and ctrc03 = s99dis
006800170720and ctrc04 = right(digits(s99bus),4)
006900170602and ctrc05 = digits(r09adt)
007000170602and ctrc06 = '470700'
007100170602and ctrc07 = ''
007200170602and CTACTV = '1'
007300170602where R09DPT beTWEEN 2 AND 17
007400170726 or   r09dpt = 97
007500170602
007600170602UNION
007700170602
007800170602SELECT DISTINCT  DECIMAL(R09ADT * 10 + 1,5,0) AS R09ADT,
007900170602TRIM(R07DSC) || ' SUPPLIES' AS R07DSC
008000170602FROM GLCUST.BRP090
008100170602join glcust.brp070 on
008200170602R07CO = R09CO
008300170602AND  R07dpt = R09adt
008400170602join glcust.bstore on
008500170602s99co = r09co
008600170602and s99loc = r09str
008700170602join gldbfa.glpct on
008800170602ctrc01 = digits(s99co)
008900170602and ctrc02 = digits(s99bv)
009000170602and ctrc03 = s99dis
009100170720and ctrc04 = right(digits(s99bus),4)
009200170602and ctrc05 = digits(r09adt)
009300170602and ctrc06 = '510700'
009400170602and ctrc07 = ''
009500170602and CTACTV = '1'
009600170602where   R09DPT BETWEEN 2 AND 17
009700170726 or   r09dpt = 97
009800170602order by 2  ;
009900170602
010000170602 CASE STORE
010100170602 WHEN 0
010200170602 THEN
010300170602    OPEN c2;
010400170602 ELSE
010500170602   OPEN C1;
010600170602 END CASE ;
010700160511End
010800160511
