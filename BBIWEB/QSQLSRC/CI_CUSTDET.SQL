000100180619  -- Retrieve the customer CREDIT information.
000101180619-- Pass in the customer number or a string of customer name
000102180619CREATE or replace PROCEDURE bbiweb.ci_custdet
000103180619   (IN COMPANY CHAR(5), CUSTOMER CHAR(14))
000104180619
000105180619result sets 1
000106180619LANGUAGE SQL
000107180619BEGIN
000108180619DECLARE C1 CURSOR FOR
000109180619SELECT CUCO,CUCUNO,CUNAME,CUAICD,CUPTPC,CCCRDM,CCCRLM,CCCBAL,USNAME,
000110180619        CCCRCP,CUTEL,USTEL,
000111180619  -- Authentication code (customer user 4)
000112180619  CUUFL4,
000113180619  -- Get description of CUUFL4 from ARPCD
000114180619  cast(coalesce(CDDESC, 'Code "' || trim(CUUFL4) || '" undefined')
000115180619     as char(30)) as CDDESC,
000116180619  -- Boolean for license required
000117180619  cast(case substr(CUUFL4,1,1)
000118180619       when 'L' then '1'
000119180619       else '0' end as char(1)) as REQ_LICENSE,
000120180619  -- Boolean for PO number required
000121180619  cast(case substr(CUUFL4,2,1)
000122180619       when 'P' then '1'
000123180619       else '0' end as char(1)) as REQ_PONUM,
000124180619  -- Boolean for employee ID required
000125180619  cast(case substr(CUUFL4,3,1)
000126180619       when 'E' then '1'
000127180619       else '0' end as char(1)) as REQ_EMPID
000128180619FROM ARDBFA.ARPCU
000129180619INNER JOIN ARDBFA.ARPCC
000130180619ON CUCO = CCCO AND CUCUNO = CCCUNO
000131180619INNER JOIN ARDBFA.ARPCD
000132180619ON CDCO = CUCO
000133180619  and CDCTC = '#C4' and CDCODE = CUUFL4
000134180619  INNER JOIN ARDBFA.ARPUS
000135180619  ON USPROF = CCCRDM
000136180619WHERE  CUCO   =  RIGHT('     ' || COMPANY,5)
000137180619AND    CUCUNO =  RIGHT('              ' || CUSTOMER,14);
000138180619OPEN c1;
004100180619End
