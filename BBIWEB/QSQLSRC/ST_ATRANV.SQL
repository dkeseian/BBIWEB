000100161107CREATE OR REPLACE PROCEDURE BBIWEB.ST_ATRANV  (IN STORE INT)
000200160613 RESULT SETS 1
000300160613 LANGUAGE SQL
000400160613 BEGIN
000500160613  DECLARE C1 CURSOR WITH RETURN FOR
000600160829  SELECT TO_CHAR(A.CREATEDTE, 'YYYY-MM-DD HH24:MI:SS')AS CHARCRTDTE,
000700160829  TO_CHAR(A.CHANGEDTE,'YYYY-MM-DD HH24:MI:SS')AS CHARCHGDTE,
000800160613  TO_CHAR(APPRVEDTE, 'YYYY-MM-DD HH24:MI:SS')AS CHARAPPDTE,
000900160613  TO_CHAR(POSTEDDTE, 'YYYY-MM-DD HH24:MI:SS')AS CHARPSTDTE,
001000160815  TO_CHAR(RECEIVDTE, 'YYYY-MM-DD HH24:MI:SS')AS CHARRCVDTE,
001100160829  IFNULL(C.TRNCOMMENT, '') AS TRNCOMMENT,
001200160613  A.*
001300160613
001400160630 FROM BBIWEB.BBV170AH A
001500160829    LEFT JOIN BBIWEB.BBP170B C  ON C.TRANSFERID = A.TRANSFERID
001600160829                 AND LINESEQ = 0
001700160829
001800161013 WHERE POSTEDFLG = ' ' AND APPRVEDTE IS NULL
001900170418 ORDER BY CREATEDTE DESC, FROMSTORE;
002000160620
002100160613 DECLARE C2 CURSOR WITH RETURN FOR
002200161017 SELECT TO_CHAR(B.CREATEDTE, 'YYYY-MM-DD HH24:MI:SS')AS CHARCRTDTE,
002300161017  TO_CHAR(B.CHANGEDTE,'YYYY-MM-DD HH24:MI:SS')AS CHARCHGDTE,
002400160613  TO_CHAR(APPRVEDTE, 'YYYY-MM-DD HH24:MI:SS')AS CHARAPPDTE,
002500160613  TO_CHAR(POSTEDDTE, 'YYYY-MM-DD HH24:MI:SS')AS CHARPSTDTE,
002600160815  TO_CHAR(RECEIVDTE, 'YYYY-MM-DD HH24:MI:SS')AS CHARRCVDTE,
002700160829  IFNULL(C.TRNCOMMENT, '') AS TRNCOMMENT,
002800160613  B.*
002900160613
003000160829 FROM BBIWEB.BBV170AH B
003100160829    LEFT JOIN BBIWEB.BBP170B C  ON C.TRANSFERID = B.TRANSFERID
003200160829                 AND LINESEQ = 0
003300160829
003400161013 WHERE FROMSTORE = STORE AND POSTEDFLG = ' ' AND APPRVEDTE IS NULL
003500170418 ORDER BY CREATEDTE DESC, FROMSTORE;
003600160829
003700160613 CASE STORE
003800160613 WHEN -999
003900160613 THEN
004000160613    OPEN C1;
004100160613 ELSE
004200160613   OPEN C2;
004300160613 END CASE ;
004400160613 END
