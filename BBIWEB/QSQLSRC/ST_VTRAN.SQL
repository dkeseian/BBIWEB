000100180125CREATE OR REPLACE PROCEDURE BBIWEB.ST_VTRAN
000200180125          (IN STORE INT)
000300180125
000400180125 RESULT SETS 1
000500180125 LANGUAGE SQL
000600180125 BEGIN
000700180125
000800160613  DECLARE C1 CURSOR WITH RETURN FOR
000900160829  SELECT TO_CHAR(A.CREATEDTE, 'YYYY-MM-DD HH24:MI:SS') AS CHARCRTDTE ,
001000160829  TO_CHAR(A.CHANGEDTE, 'YYYY-MM-DD HH24:MI:SS') AS CHARCHGDTE,
001100160615  TO_CHAR(APPRVEDTE, 'YYYY-MM-DD HH24:MI:SS') AS CHARAPPDTE,
001200160615  TO_CHAR(POSTEDDTE, 'YYYY-MM-DD HH24:MI:SS') AS CHARPSTDTE,
001300160815  TO_CHAR(RECEIVDTE, 'YYYY-MM-DD HH24:MI:SS') AS CHARRCVDTE,
001400160829  IFNULL(C.TRNCOMMENT, '') AS TRNCOMMENT,
001500160613  A.*
001600160613
001700160630 FROM BBIWEB.BBV170AH A
001800160829    LEFT JOIN BBIWEB.BBP170B C  ON C.TRANSFERID = A.TRANSFERID
001900160829                 AND LINESEQ = 0
002000170418 ORDER BY  CREATEDTE DESC, TOSTORE;
002100160615
002200160613 DECLARE C2 CURSOR WITH RETURN FOR
002300161017  SELECT TO_CHAR(B.CREATEDTE, 'YYYY-MM-DD HH24:MI:SS') AS CHARCRTDTE ,
002400161017  TO_CHAR(B.CHANGEDTE, 'YYYY-MM-DD HH24:MI:SS') AS CHARCHGDTE,
002500160615  TO_CHAR(APPRVEDTE, 'YYYY-MM-DD HH24:MI:SS') AS CHARAPPDTE,
002600160615  TO_CHAR(POSTEDDTE, 'YYYY-MM-DD HH24:MI:SS') AS CHARPSTDTE,
002700160815  TO_CHAR(RECEIVDTE, 'YYYY-MM-DD HH24:MI:SS') AS CHARRCVDTE,
002800160829  IFNULL(C.TRNCOMMENT, '') AS TRNCOMMENT,
002900160613  B.*
003000160613
003100160630 FROM BBIWEB.BBV170AH B
003200160829    LEFT JOIN BBIWEB.BBP170B C  ON C.TRANSFERID = B.TRANSFERID
003300160829                 AND LINESEQ = 0
003400160620 WHERE TOSTORE = STORE OR FROMSTORE = STORE
003500170418 ORDER BY  CREATEDTE DESC, TOSTORE;
003600160829
003700160613 CASE STORE
003800160613 WHEN -999
003900160613 THEN
004000160613    OPEN C1;
004100160613 ELSE
004200160613   OPEN C2;
004300160613 END CASE ;
004400160613 END
